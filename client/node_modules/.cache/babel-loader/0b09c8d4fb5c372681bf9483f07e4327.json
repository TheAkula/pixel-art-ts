{"ast":null,"code":"import _slicedToArray from\"C:/Users/Pechenka/pixel-app-ts/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useEffect,useRef,useState}from\"react\";import classes from\"./SaveImage.module.css\";import{ArtsContext}from\"../../../context/arts-context\";import{SettingsContext}from\"../../../context/settings-context\";import{jsx as _jsx}from\"react/jsx-runtime\";var SaveImage=function SaveImage(){var _useContext=useContext(SettingsContext),settings=_useContext.settings;var _ref=useContext(ArtsContext),arts=_ref.arts;var socket=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),imgId=_useState2[0],setImgId=_useState2[1];useEffect(function(){var s=new WebSocket(\"ws://\");s.onopen=function(e){console.log(\"connection\");};s.onmessage=function(e){var id=JSON.parse(e.data).id;setImgId(id);fetch(\"/get-img/\"+id,{method:\"GET\"}).then(function(res){return res.blob();}).then(function(data){var blob=new Blob([data]);var link=document.createElement(\"a\");link.href=window.URL.createObjectURL(blob);link.download=\"download.png\";link.click();}).catch(function(err){console.log(err.message);});};socket.current=s;return function(){if(imgId){s.send(JSON.stringify({type:\"DELETE_IMG\",id:imgId}));}};},[]);var onSaveImage=function onSaveImage(e){e.preventDefault();var art=arts.arts.find(function(art){return art.id===arts.chosen;});socket.current.send(JSON.stringify({type:\"CREATE_IMG\",img:art,cs:settings.columnSize,rs:settings.rowSize,dc:settings.defColor}));};return/*#__PURE__*/_jsx(\"form\",{onSubmit:onSaveImage,children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:classes.SaveImage,children:\"SAVE\"})});};export default SaveImage;","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/components/ToolsBar/SaveImage/SaveImage.tsx"],"names":["useContext","useEffect","useRef","useState","classes","ArtsContext","SettingsContext","SaveImage","settings","arts","socket","imgId","setImgId","s","WebSocket","onopen","e","console","log","onmessage","id","JSON","parse","data","fetch","method","then","res","blob","Blob","link","document","createElement","href","window","URL","createObjectURL","download","click","catch","err","message","current","send","stringify","type","onSaveImage","preventDefault","art","find","chosen","img","cs","columnSize","rs","rowSize","dc","defColor"],"mappings":"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","sourcesContent":["import {\r\n  FormEventHandler,\r\n  MutableRefObject,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport classes from \"./SaveImage.module.css\";\r\nimport { Art, ArtsContext } from \"../../../context/arts-context\";\r\nimport { SettingsContext } from \"../../../context/settings-context\";\r\nimport { createCanvas } from \"canvas\";\r\n\r\nconst SaveImage = () => {\r\n  const { settings } = useContext(SettingsContext);\r\n  const { arts } = useContext(ArtsContext)!;\r\n  const socket = useRef<null | WebSocket>(null);\r\n  const [imgId, setImgId] = useState<null | string>(null);\r\n\r\n  useEffect(() => {\r\n    const s = new WebSocket(\"ws://\");\r\n    s.onopen = (e) => {\r\n      console.log(\"connection\");\r\n    };\r\n    s.onmessage = function (e) {\r\n      const id = JSON.parse(e.data).id;\r\n      setImgId(id);\r\n      fetch(\"/get-img/\" + id, {\r\n        method: \"GET\",\r\n      })\r\n        .then((res) => {\r\n          return res.blob();\r\n        })\r\n        .then((data) => {\r\n          const blob = new Blob([data]);\r\n          const link = document.createElement(\"a\");\r\n          link.href = window.URL.createObjectURL(blob);\r\n          link.download = \"download.png\";\r\n          link.click();\r\n        })\r\n        .catch((err) => {\r\n          console.log(err.message);\r\n        });\r\n    };\r\n    socket.current = s;\r\n    return () => {\r\n      if (imgId) {\r\n        s.send(JSON.stringify({ type: \"DELETE_IMG\", id: imgId }));\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const onSaveImage: FormEventHandler = (e) => {\r\n    e.preventDefault();\r\n    const art = arts.arts.find((art) => art.id === arts.chosen)!;\r\n    socket.current!.send(\r\n      JSON.stringify({\r\n        type: \"CREATE_IMG\",\r\n        img: art,\r\n        cs: settings!.columnSize,\r\n        rs: settings!.rowSize,\r\n        dc: settings!.defColor,\r\n      })\r\n    );\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={onSaveImage}>\r\n      <button type=\"submit\" className={classes.SaveImage}>\r\n        SAVE\r\n      </button>\r\n      {/* <input type=\"hidden\" name=\"img\" value={JSON.stringify(img)} />\r\n      <input type=\"hidden\" name=\"cs\" value={settings!.columnSize} />\r\n      <input type=\"hidden\" name=\"rs\" value={settings!.rowSize} />\r\n      <input type=\"hidden\" name=\"dc\" value={settings!.defColor} /> */}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SaveImage;\r\n"]},"metadata":{},"sourceType":"module"}