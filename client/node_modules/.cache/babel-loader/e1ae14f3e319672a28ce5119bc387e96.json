{"ast":null,"code":"import _slicedToArray from\"C:/Users/Pechenka/pixel-app-ts/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useEffect,useRef,useState}from\"react\";import classes from\"./SaveImage.module.css\";import{ArtsContext}from\"../../context/arts-context\";import Modal from\"../UI/Modal/Modal\";import Button from\"../UI/Button/Button\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SaveImage=function SaveImage(){var _ref=useContext(ArtsContext),artsState=_ref.artsState;var socket=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),imgUrl=_useState4[0],setImgUrl=_useState4[1];useEffect(function(){var s=new WebSocket(\"wss://pixel-art-ts.herokuapp.com/\");s.onopen=function(e){};s.onmessage=function(e){var id=JSON.parse(e.data).id;fetch(\"/get-img/\"+id,{method:\"GET\"}).then(function(res){return res.blob();}).then(function(data){setShowModal(true);var blob=new Blob([data]);var url=window.URL.createObjectURL(blob);setImgUrl(url);}).catch(function(err){});};socket.current=s;},[]);var onSaveImage=function onSaveImage(e){e.preventDefault();var art=artsState.arts.find(function(art){return art.id===artsState.chosen;});socket.current.send(JSON.stringify({type:\"CREATE_IMG\",img:art,ps:artsState.settings.pixelSize,cs:artsState.settings.columnSize,rs:artsState.settings.rowSize,dc:artsState.settings.defColor}));};var onCloseModal=function onCloseModal(){setShowModal(false);};var onDownloadImg=function onDownloadImg(){var link=document.createElement(\"a\");link.download=\"download.png\";link.href=imgUrl;link.click();};var chosenArt=artsState.arts.find(function(art){return art.id===artsState.chosen;});var modal;if(showModal){modal=/*#__PURE__*/_jsxs(Modal,{closed:onCloseModal,children:[/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"PREVIEW\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.ImgContainer,children:chosenArt.rows.map(function(row,i){return/*#__PURE__*/_jsx(\"div\",{className:classes.ArtRow,children:row.map(function(pix){return/*#__PURE__*/_jsx(\"div\",{style:{backgroundColor:pix.color,width:\"10px\",height:\"10px\"}},pix.ypos.toString()+pix.xpos);})},i);})}),/*#__PURE__*/_jsx(\"button\",{className:classes.DownloadButton,onClick:onDownloadImg,children:\"DOWNLOAD\"})]});}return/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSaveImage,children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"DOWNLOAD\"}),showModal&&modal]});};export default SaveImage;","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/components/SaveImage/SaveImage.tsx"],"names":["useContext","useEffect","useRef","useState","classes","ArtsContext","Modal","Button","SaveImage","artsState","socket","showModal","setShowModal","imgUrl","setImgUrl","s","WebSocket","onopen","e","onmessage","id","JSON","parse","data","fetch","method","then","res","blob","Blob","url","window","URL","createObjectURL","catch","err","current","onSaveImage","preventDefault","art","arts","find","chosen","send","stringify","type","img","ps","settings","pixelSize","cs","columnSize","rs","rowSize","dc","defColor","onCloseModal","onDownloadImg","link","document","createElement","download","href","click","chosenArt","modal","textAlign","ImgContainer","rows","map","row","i","ArtRow","pix","backgroundColor","color","width","height","ypos","toString","xpos","DownloadButton"],"mappings":"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","sourcesContent":["import {\r\n  FormEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport classes from \"./SaveImage.module.css\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport Modal from \"../UI/Modal/Modal\";\r\nimport Button from \"../UI/Button/Button\";\r\n\r\nconst SaveImage = () => {\r\n  const { artsState } = useContext(ArtsContext)!;\r\n  const socket = useRef<null | WebSocket>(null);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [imgUrl, setImgUrl] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const s = new WebSocket(\"wss://pixel-art-ts.herokuapp.com/\");\r\n    s.onopen = (e) => {};\r\n    s.onmessage = function (e) {\r\n      const id = JSON.parse(e.data).id;\r\n      fetch(\"/get-img/\" + id, {\r\n        method: \"GET\",\r\n      })\r\n        .then((res) => {\r\n          return res.blob();\r\n        })\r\n        .then((data) => {\r\n          setShowModal(true);\r\n          const blob = new Blob([data]);\r\n          const url = window.URL.createObjectURL(blob);\r\n          setImgUrl(url);\r\n        })\r\n        .catch((err) => {});\r\n    };\r\n    socket.current = s;\r\n  }, []);\r\n\r\n  const onSaveImage: FormEventHandler = (e) => {\r\n    e.preventDefault();\r\n    const art = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n    socket.current!.send(\r\n      JSON.stringify({\r\n        type: \"CREATE_IMG\",\r\n        img: art,\r\n        ps: artsState.settings.pixelSize,\r\n        cs: artsState.settings.columnSize,\r\n        rs: artsState.settings.rowSize,\r\n        dc: artsState.settings.defColor,\r\n      })\r\n    );\r\n  };\r\n\r\n  const onCloseModal = () => {\r\n    setShowModal(false);\r\n  };\r\n\r\n  const onDownloadImg = () => {\r\n    const link = document.createElement(\"a\");\r\n    link.download = \"download.png\";\r\n    link.href = imgUrl;\r\n    link.click();\r\n  };\r\n\r\n  const chosenArt = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n\r\n  let modal;\r\n  if (showModal) {\r\n    modal = (\r\n      <Modal closed={onCloseModal}>\r\n        <h2 style={{ textAlign: \"center\" }}>PREVIEW</h2>\r\n        <div className={classes.ImgContainer}>\r\n          {chosenArt.rows.map((row, i) => (\r\n            <div className={classes.ArtRow} key={i}>\r\n              {row.map((pix) => (\r\n                <div\r\n                  key={pix.ypos.toString() + pix.xpos}\r\n                  style={{\r\n                    backgroundColor: pix.color,\r\n                    width: \"10px\",\r\n                    height: \"10px\",\r\n                  }}\r\n                ></div>\r\n              ))}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button className={classes.DownloadButton} onClick={onDownloadImg}>\r\n          DOWNLOAD\r\n        </button>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSaveImage}>\r\n      <Button type=\"submit\">DOWNLOAD</Button>\r\n      {showModal && modal}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SaveImage;\r\n"]},"metadata":{},"sourceType":"module"}