{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Pechenka\\\\pixel-app-ts\\\\client\\\\src\\\\components\\\\SaveImage\\\\SaveImage.tsx\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useRef, useState } from \"react\";\nimport classes from \"./SaveImage.module.css\";\nimport { ArtsContext } from \"../../context/arts-context\";\nimport Modal from \"../UI/Modal/Modal\";\nimport Button from \"../UI/Button/Button\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SaveImage = () => {\n  _s();\n\n  const {\n    artsState\n  } = useContext(ArtsContext);\n  const socket = useRef(null);\n  const [showModal, setShowModal] = useState(false);\n  const [imgUrl, setImgUrl] = useState(\"\");\n  useEffect(() => {\n    const s = new WebSocket(\"ws://localhost:3001\");\n\n    s.onopen = e => {};\n\n    s.onmessage = function (e) {\n      const id = JSON.parse(e.data).id;\n      fetch(\"/get-img/\" + id, {\n        method: \"GET\"\n      }).then(res => {\n        return res.blob();\n      }).then(data => {\n        setShowModal(true);\n        const blob = new Blob([data]);\n        const url = window.URL.createObjectURL(blob);\n        setImgUrl(url);\n      }).catch(err => {});\n    };\n\n    socket.current = s;\n  }, []);\n\n  const onSaveImage = e => {\n    e.preventDefault();\n    const art = artsState.arts.find(art => art.id === artsState.chosen);\n    socket.current.send(JSON.stringify({\n      type: \"CREATE_IMG\",\n      img: art,\n      ps: artsState.settings.pixelSize,\n      cs: artsState.settings.columnSize,\n      rs: artsState.settings.rowSize,\n      dc: artsState.settings.defColor\n    }));\n  };\n\n  const onCloseModal = () => {\n    setShowModal(false);\n  };\n\n  const onDownloadImg = () => {\n    const link = document.createElement(\"a\");\n    link.download = \"download.png\";\n    link.href = imgUrl;\n    link.click();\n  };\n\n  const chosenArt = artsState.arts.find(art => art.id === artsState.chosen);\n  let modal;\n\n  if (showModal) {\n    modal = /*#__PURE__*/_jsxDEV(Modal, {\n      closed: onCloseModal,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          textAlign: \"center\"\n        },\n        children: \"PREVIEW\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.ImgContainer,\n        children: chosenArt.rows.map((row, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.ArtRow,\n          children: row.map(pix => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              backgroundColor: pix.color,\n              width: \"10px\",\n              height: \"10px\"\n            }\n          }, pix.ypos.toString() + pix.xpos, false, {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 17\n          }, this))\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: classes.DownloadButton,\n        onClick: onDownloadImg,\n        children: \"DOWNLOAD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: onSaveImage,\n    children: [/*#__PURE__*/_jsxDEV(Button, {\n      type: \"submit\",\n      children: \"DOWNLOAD\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), showModal && modal]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SaveImage, \"m2ieeNuJa3Mob9mXmEFh1CvFLJQ=\");\n\n_c = SaveImage;\nexport default SaveImage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SaveImage\");","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/components/SaveImage/SaveImage.tsx"],"names":["useContext","useEffect","useRef","useState","classes","ArtsContext","Modal","Button","SaveImage","artsState","socket","showModal","setShowModal","imgUrl","setImgUrl","s","WebSocket","onopen","e","onmessage","id","JSON","parse","data","fetch","method","then","res","blob","Blob","url","window","URL","createObjectURL","catch","err","current","onSaveImage","preventDefault","art","arts","find","chosen","send","stringify","type","img","ps","settings","pixelSize","cs","columnSize","rs","rowSize","dc","defColor","onCloseModal","onDownloadImg","link","document","createElement","download","href","click","chosenArt","modal","textAlign","ImgContainer","rows","map","row","i","ArtRow","pix","backgroundColor","color","width","height","ypos","toString","xpos","DownloadButton"],"mappings":"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","sourcesContent":["import {\r\n  FormEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport classes from \"./SaveImage.module.css\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport Modal from \"../UI/Modal/Modal\";\r\nimport Button from \"../UI/Button/Button\";\r\n\r\nconst SaveImage = () => {\r\n  const { artsState } = useContext(ArtsContext)!;\r\n  const socket = useRef<null | WebSocket>(null);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [imgUrl, setImgUrl] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const s = new WebSocket(\"ws://localhost:3001\");\r\n    s.onopen = (e) => {};\r\n    s.onmessage = function (e) {\r\n      const id = JSON.parse(e.data).id;\r\n      fetch(\"/get-img/\" + id, {\r\n        method: \"GET\",\r\n      })\r\n        .then((res) => {\r\n          return res.blob();\r\n        })\r\n        .then((data) => {\r\n          setShowModal(true);\r\n          const blob = new Blob([data]);\r\n          const url = window.URL.createObjectURL(blob);\r\n          setImgUrl(url);\r\n        })\r\n        .catch((err) => {});\r\n    };\r\n    socket.current = s;\r\n  }, []);\r\n\r\n  const onSaveImage: FormEventHandler = (e) => {\r\n    e.preventDefault();\r\n    const art = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n    socket.current!.send(\r\n      JSON.stringify({\r\n        type: \"CREATE_IMG\",\r\n        img: art,\r\n        ps: artsState.settings.pixelSize,\r\n        cs: artsState.settings.columnSize,\r\n        rs: artsState.settings.rowSize,\r\n        dc: artsState.settings.defColor,\r\n      })\r\n    );\r\n  };\r\n\r\n  const onCloseModal = () => {\r\n    setShowModal(false);\r\n  };\r\n\r\n  const onDownloadImg = () => {\r\n    const link = document.createElement(\"a\");\r\n    link.download = \"download.png\";\r\n    link.href = imgUrl;\r\n    link.click();\r\n  };\r\n\r\n  const chosenArt = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n\r\n  let modal;\r\n  if (showModal) {\r\n    modal = (\r\n      <Modal closed={onCloseModal}>\r\n        <h2 style={{ textAlign: \"center\" }}>PREVIEW</h2>\r\n        <div className={classes.ImgContainer}>\r\n          {chosenArt.rows.map((row, i) => (\r\n            <div className={classes.ArtRow} key={i}>\r\n              {row.map((pix) => (\r\n                <div\r\n                  key={pix.ypos.toString() + pix.xpos}\r\n                  style={{\r\n                    backgroundColor: pix.color,\r\n                    width: \"10px\",\r\n                    height: \"10px\",\r\n                  }}\r\n                ></div>\r\n              ))}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button className={classes.DownloadButton} onClick={onDownloadImg}>\r\n          DOWNLOAD\r\n        </button>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSaveImage}>\r\n      <Button type=\"submit\">DOWNLOAD</Button>\r\n      {showModal && modal}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SaveImage;\r\n"]},"metadata":{},"sourceType":"module"}