{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Pechenka\\\\pixel-app-ts\\\\client\\\\src\\\\context\\\\arts-context.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useReducer } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  artsState: {\n    arts: [],\n    chosen: null,\n    settings: {\n      defColor: \"#000\",\n      rowSize: 16,\n      columnSize: 16,\n      color: \"#000\",\n      tool: null\n    }\n  },\n  history: {\n    prevHistory: [],\n    nextHistory: []\n  }\n};\nexport const ArtsContext = /*#__PURE__*/React.createContext(null);\n\nconst reducer = (state, action) => {\n  const curSnapshot = { ...JSON.parse(JSON.stringify(state.artsState))\n  };\n  const newHistory = {\n    prevHistory: state.history.prevHistory.concat([curSnapshot]),\n    nextHistory: []\n  };\n\n  switch (action.type) {\n    case \"ADD_ART\":\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: [...state.artsState.arts, action.data],\n          chosen: action.data.id\n        },\n        history: newHistory\n      };\n\n    case \"ADD_ROW\":\n      const newArts = JSON.parse(JSON.stringify(state.artsState.arts));\n      newArts.forEach(art => {\n        art.rows.push(action.data);\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: newArts\n        },\n        history: newHistory\n      };\n\n    case \"DEL_ROW\":\n      const arts = JSON.parse(JSON.stringify(state.artsState.arts));\n      if (arts[0].rows.length === 1) return { ...state,\n        arts: state.artsState.arts\n      };\n      arts.forEach(art => {\n        art.rows.pop();\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: arts\n        },\n        history: newHistory\n      };\n\n    case \"ADD_COL\":\n      const arts1 = JSON.parse(JSON.stringify(state.artsState.arts));\n      arts1.forEach(art => {\n        art.rows.forEach((row, id) => {\n          row.push({\n            xpos: action.data.x,\n            ypos: id,\n            color: action.data.color\n          });\n        });\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: arts1\n        },\n        history: newHistory\n      };\n\n    case \"DEL_COL\":\n      const arts2 = JSON.parse(JSON.stringify(state.artsState.arts));\n      if (arts2[0].rows[0].length === 1) return { ...state,\n        artsState: { ...state.artsState,\n          arts: state.artsState.arts\n        }\n      };\n      arts2.forEach(art => {\n        art.rows.forEach(row => {\n          row.pop();\n        });\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: arts2\n        },\n        history: newHistory\n      };\n\n    case \"SET_CHOSEN\":\n      return { ...state,\n        artsState: { ...state.artsState,\n          chosen: action.data\n        },\n        history: newHistory\n      };\n\n    case \"SET_PIX\":\n      let arts3 = JSON.parse(JSON.stringify(state.artsState.arts));\n      const a = arts3.find(art => art.id === action.artId);\n      arts3[arts3.indexOf(a)].rows[action.y][action.x].color = action.data;\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: arts3\n        },\n        history: newHistory\n      };\n\n    case \"DELETE_ART\":\n      if (state.artsState.arts.length === 1) return { ...state\n      };\n      const deletedArt = state.artsState.arts.find(art => art.id === action.data);\n      const arts4 = JSON.parse(JSON.stringify(state.artsState.arts));\n      const startArts = arts4.slice(0, deletedArt.id);\n      const endArts = arts4.slice(deletedArt.id + 1);\n      endArts.forEach(art => {\n        art.id = art.id - 1;\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          chosen: state.artsState.arts.length - 2,\n          arts: startArts.concat(endArts)\n        },\n        history: newHistory\n      };\n\n    case \"COPY_ART\":\n      const copiedArt = JSON.parse(JSON.stringify(state.artsState.arts.find(art => art.id === action.data)));\n      const newArts1 = JSON.parse(JSON.stringify(state.artsState.arts));\n      copiedArt.id = copiedArt.id + 1;\n      const updArts1 = newArts1.slice(0, copiedArt.id).concat(copiedArt);\n      const updArts2 = newArts1.slice(copiedArt.id).map(art => {\n        art.id = art.id + 1;\n        return art;\n      });\n      return { ...state,\n        artsState: { ...state.artsState,\n          chosen: state.artsState.chosen + 1,\n          arts: updArts1.concat(updArts2)\n        },\n        history: newHistory\n      };\n\n    case \"UPD_ART\":\n      const updatedArts = JSON.parse(JSON.stringify(state.artsState.arts));\n      let art = updatedArts.find(art => art.id === action.artId);\n      updatedArts[updatedArts.indexOf(art)] = action.data;\n      return { ...state,\n        artsState: { ...state.artsState,\n          arts: updatedArts,\n          chosen: state.artsState.chosen\n        },\n        history: newHistory\n      };\n\n    case \"BACK_HIS\":\n      if (!state.history.prevHistory.length) {\n        return { ...state\n        };\n      }\n\n      const lastSnapshot = state.history.prevHistory.at(-1);\n      if (!lastSnapshot.arts.length) return { ...state\n      };\n      return { ...state,\n        history: {\n          prevHistory: state.history.prevHistory.slice(0, -1),\n          nextHistory: state.history.nextHistory.concat([JSON.parse(JSON.stringify(state))])\n        },\n        artsState: { ...lastSnapshot\n        }\n      };\n\n    case \"NEXT_HIS\":\n      if (!state.history.nextHistory.length) {\n        return { ...state\n        };\n      }\n\n      const lastSnapshot1 = state.history.nextHistory.at(-1);\n      if (!lastSnapshot1.arts) return { ...state\n      };\n      return { ...state,\n        history: {\n          prevHistory: state.history.prevHistory.concat([JSON.parse(JSON.stringify(state))]),\n          nextHistory: state.history.nextHistory.slice(0, -1)\n        },\n        artsState: { ...lastSnapshot1\n        }\n      };\n\n    default:\n      throw new Error(\"Uncaught type: \" + action.type);\n  }\n};\n\nconst ArtsContextProvider = props => {\n  _s();\n\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return /*#__PURE__*/_jsxDEV(ArtsContext.Provider, {\n    value: {\n      artsState: state.artsState,\n      artsDispatch: dispatch\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 295,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ArtsContextProvider, \"6JWkGZ32UPfojeNx+xqn8ZU8A0Q=\");\n\n_c = ArtsContextProvider;\nexport default ArtsContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ArtsContextProvider\");","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/context/arts-context.tsx"],"names":["React","useReducer","initialState","artsState","arts","chosen","settings","defColor","rowSize","columnSize","color","tool","history","prevHistory","nextHistory","ArtsContext","createContext","reducer","state","action","curSnapshot","JSON","parse","stringify","newHistory","concat","type","data","id","newArts","forEach","art","rows","push","length","pop","arts1","row","xpos","x","ypos","arts2","arts3","a","find","artId","indexOf","y","deletedArt","arts4","startArts","slice","endArts","copiedArt","newArts1","updArts1","updArts2","map","updatedArts","lastSnapshot","at","lastSnapshot1","Error","ArtsContextProvider","props","dispatch","artsDispatch","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from \"react\";\r\n\r\nexport interface Pixel {\r\n  xpos: number;\r\n  ypos: number;\r\n  color: string;\r\n}\r\n\r\nexport interface Art {\r\n  rows: Pixel[][];\r\n  id: number;\r\n}\r\n\r\ntype HistoryItem = ArtsState;\r\n\r\ntype History = HistoryItem[];\r\n\r\ninterface HistoryState {\r\n  prevHistory: History;\r\n  nextHistory: History;\r\n}\r\n\r\ninterface SettingsState {\r\n  defColor: string;\r\n  rowSize: number;\r\n  columnSize: number;\r\n  color: string;\r\n  tool: \"BRUSH\" | \"FILL\" | \"ERASER\" | \"PIPETTE\" | \"MOVE\" | null;\r\n}\r\n\r\ninterface ArtsState {\r\n  arts: Art[];\r\n  chosen: number | null;\r\n  settings: SettingsState;\r\n}\r\n\r\ninterface ArtsReducerState {\r\n  artsState: ArtsState;\r\n  history: HistoryState;\r\n}\r\n\r\ninterface ArtsReducerAction {\r\n  type: string;\r\n  data?: any;\r\n  artId?: number;\r\n  x?: number;\r\n  y?: number;\r\n}\r\n\r\ninterface ArtsProviderValue {\r\n  artsState: ArtsState;\r\n  artsDispatch: React.Dispatch<ArtsReducerAction>;\r\n}\r\n\r\nconst initialState: ArtsReducerState = {\r\n  artsState: {\r\n    arts: [],\r\n    chosen: null,\r\n    settings: {\r\n      defColor: \"#000\",\r\n      rowSize: 16,\r\n      columnSize: 16,\r\n      color: \"#000\",\r\n      tool: null,\r\n    },\r\n  },\r\n\r\n  history: {\r\n    prevHistory: [],\r\n    nextHistory: [],\r\n  },\r\n};\r\n\r\nexport const ArtsContext = React.createContext<ArtsProviderValue | null>(null);\r\n\r\ninterface ArtsReducer {\r\n  (a: ArtsReducerState, b: ArtsReducerAction): ArtsReducerState;\r\n}\r\n\r\nconst reducer: ArtsReducer = (state, action) => {\r\n  const curSnapshot = { ...JSON.parse(JSON.stringify(state.artsState)) };\r\n  const newHistory = {\r\n    prevHistory: state.history.prevHistory.concat([curSnapshot]),\r\n    nextHistory: [],\r\n  };\r\n  switch (action.type) {\r\n    case \"ADD_ART\":\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: [...state.artsState.arts!, action.data],\r\n          chosen: action.data.id,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"ADD_ROW\":\r\n      const newArts = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      newArts.forEach((art) => {\r\n        art.rows.push(action.data);\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: newArts,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"DEL_ROW\":\r\n      const arts = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      if (arts[0].rows.length === 1)\r\n        return { ...state, arts: state.artsState.arts };\r\n      arts.forEach((art) => {\r\n        art.rows.pop();\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n\r\n          arts: arts,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"ADD_COL\":\r\n      const arts1 = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      arts1.forEach((art) => {\r\n        art.rows.forEach((row, id) => {\r\n          row.push({ xpos: action.data.x, ypos: id, color: action.data.color });\r\n        });\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: arts1,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"DEL_COL\":\r\n      const arts2 = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      if (arts2[0].rows[0].length === 1)\r\n        return {\r\n          ...state,\r\n          artsState: {\r\n            ...state.artsState,\r\n            arts: state.artsState.arts,\r\n          },\r\n        };\r\n      arts2.forEach((art) => {\r\n        art.rows.forEach((row) => {\r\n          row.pop();\r\n        });\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: arts2,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"SET_CHOSEN\":\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          chosen: action.data,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"SET_PIX\":\r\n      let arts3 = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      const a = arts3.find((art) => art.id === action.artId)!;\r\n      arts3[arts3.indexOf(a)].rows[action.y!][action.x!].color = action.data;\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: arts3,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"DELETE_ART\":\r\n      if (state.artsState.arts.length === 1)\r\n        return {\r\n          ...state,\r\n        };\r\n      const deletedArt = state.artsState.arts.find(\r\n        (art) => art.id === action.data\r\n      )!;\r\n      const arts4 = JSON.parse(JSON.stringify(state.artsState.arts)) as Art[];\r\n      const startArts = arts4.slice(0, deletedArt.id);\r\n      const endArts = arts4.slice(deletedArt.id + 1);\r\n      endArts.forEach((art) => {\r\n        art.id = art.id - 1;\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          chosen: state.artsState.arts.length - 2,\r\n          arts: startArts.concat(endArts),\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"COPY_ART\":\r\n      const copiedArt = JSON.parse(\r\n        JSON.stringify(\r\n          state.artsState.arts.find((art) => art.id === action.data)\r\n        )\r\n      );\r\n      const newArts1 = JSON.parse(\r\n        JSON.stringify(state.artsState.arts)\r\n      ) as Art[];\r\n      copiedArt.id = copiedArt.id + 1;\r\n      const updArts1 = newArts1.slice(0, copiedArt.id).concat(copiedArt);\r\n      const updArts2 = newArts1.slice(copiedArt.id).map((art) => {\r\n        art.id = art.id + 1;\r\n        return art;\r\n      });\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          chosen: state.artsState.chosen! + 1,\r\n          arts: updArts1.concat(updArts2),\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"UPD_ART\":\r\n      const updatedArts = JSON.parse(\r\n        JSON.stringify(state.artsState.arts)\r\n      ) as Art[];\r\n      let art = updatedArts.find((art) => art.id === action.artId)!;\r\n      updatedArts[updatedArts.indexOf(art)] = action.data;\r\n      return {\r\n        ...state,\r\n        artsState: {\r\n          ...state.artsState,\r\n          arts: updatedArts,\r\n          chosen: state.artsState.chosen,\r\n        },\r\n        history: newHistory,\r\n      };\r\n    case \"BACK_HIS\":\r\n      if (!state.history.prevHistory.length) {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n      const lastSnapshot = state.history.prevHistory.at(-1)!;\r\n      if (!lastSnapshot.arts.length) return { ...state };\r\n      return {\r\n        ...state,\r\n        history: {\r\n          prevHistory: state.history.prevHistory.slice(0, -1),\r\n          nextHistory: state.history.nextHistory.concat([\r\n            JSON.parse(JSON.stringify(state)),\r\n          ]),\r\n        },\r\n        artsState: {\r\n          ...lastSnapshot,\r\n        },\r\n      };\r\n    case \"NEXT_HIS\":\r\n      if (!state.history.nextHistory.length) {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n      const lastSnapshot1 = state.history.nextHistory.at(-1)!;\r\n      if (!lastSnapshot1.arts) return { ...state };\r\n      return {\r\n        ...state,\r\n        history: {\r\n          prevHistory: state.history.prevHistory.concat([\r\n            JSON.parse(JSON.stringify(state)),\r\n          ]),\r\n          nextHistory: state.history.nextHistory.slice(0, -1),\r\n        },\r\n        artsState: {\r\n          ...lastSnapshot1,\r\n        },\r\n      };\r\n    default:\r\n      throw new Error(\"Uncaught type: \" + action.type);\r\n  }\r\n};\r\n\r\nconst ArtsContextProvider = (props: any) => {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n  return (\r\n    <ArtsContext.Provider\r\n      value={{ artsState: state.artsState, artsDispatch: dispatch }}\r\n    >\r\n      {props.children}\r\n    </ArtsContext.Provider>\r\n  );\r\n};\r\n\r\nexport default ArtsContextProvider;\r\n"]},"metadata":{},"sourceType":"module"}