{"ast":null,"code":"import _slicedToArray from\"C:/Users/Pechenka/pixel-app-ts/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useEffect,useState}from\"react\";import classes from\"./SaveImage.module.css\";import{ArtsContext}from\"../../context/arts-context\";import Modal from\"../UI/Modal/Modal\";import Button from\"../UI/Button/Button\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SaveImage=function SaveImage(){var _ref=useContext(ArtsContext),artsState=_ref.artsState;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),imgUrl=_useState4[0],setImgUrl=_useState4[1];useEffect(function(){if(showModal)document.body.style.overflow=\"hidden\";else document.body.style.overflow=\"auto\";},[showModal]);var onSaveImage=function onSaveImage(e){e.preventDefault();var s=new WebSocket(\"wss://pixel-art-ts.herokuapp.com\");s.onopen=function(e){var art=artsState.arts.find(function(art){return art.id===artsState.chosen;});s.send(JSON.stringify({type:\"CREATE_IMG\",img:art,ps:artsState.settings.pixelSize,cs:artsState.settings.columnSize,rs:artsState.settings.rowSize,dc:artsState.settings.defColor}));};s.onmessage=function(e){var id=JSON.parse(e.data).id;fetch(\"/get-img/\"+id,{method:\"GET\"}).then(function(res){return res.blob();}).then(function(data){setShowModal(true);var blob=new Blob([data]);var url=window.URL.createObjectURL(blob);setImgUrl(url);s.close();}).catch(function(err){s.close();});};};var onCloseModal=function onCloseModal(){setShowModal(false);};var onDownloadImg=function onDownloadImg(){var link=document.createElement(\"a\");link.download=\"download.png\";link.href=imgUrl;link.click();};var chosenArt=artsState.arts.find(function(art){return art.id===artsState.chosen;});var modal;if(showModal){modal=/*#__PURE__*/_jsxs(Modal,{closed:onCloseModal,children:[/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"PREVIEW\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.ImgContainer,children:chosenArt.rows.map(function(row,i){return/*#__PURE__*/_jsx(\"div\",{className:classes.ArtRow,children:row.map(function(pix){return/*#__PURE__*/_jsx(\"div\",{style:{backgroundColor:pix.color,width:\"10px\",height:\"10px\"}},pix.ypos.toString()+pix.xpos);})},i);})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:classes.DownloadButton,onClick:onDownloadImg,children:\"DOWNLOAD\"})]});}return/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSaveImage,children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"DOWNLOAD\"}),showModal&&modal]});};export default SaveImage;","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/components/SaveImage/SaveImage.tsx"],"names":["useContext","useEffect","useState","classes","ArtsContext","Modal","Button","SaveImage","artsState","showModal","setShowModal","imgUrl","setImgUrl","document","body","style","overflow","onSaveImage","e","preventDefault","s","WebSocket","onopen","art","arts","find","id","chosen","send","JSON","stringify","type","img","ps","settings","pixelSize","cs","columnSize","rs","rowSize","dc","defColor","onmessage","parse","data","fetch","method","then","res","blob","Blob","url","window","URL","createObjectURL","close","catch","err","onCloseModal","onDownloadImg","link","createElement","download","href","click","chosenArt","modal","textAlign","ImgContainer","rows","map","row","i","ArtRow","pix","backgroundColor","color","width","height","ypos","toString","xpos","DownloadButton"],"mappings":"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","sourcesContent":["import {\r\n  FormEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport classes from \"./SaveImage.module.css\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport Modal from \"../UI/Modal/Modal\";\r\nimport Button from \"../UI/Button/Button\";\r\n\r\nconst SaveImage = () => {\r\n  const { artsState } = useContext(ArtsContext)!;\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [imgUrl, setImgUrl] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (showModal) document.body.style.overflow = \"hidden\";\r\n    else document.body.style.overflow = \"auto\";\r\n  }, [showModal]);\r\n\r\n  const onSaveImage: FormEventHandler = (e) => {\r\n    e.preventDefault();\r\n    const s = new WebSocket(\"wss://pixel-art-ts.herokuapp.com\");\r\n    s.onopen = (e) => {\r\n      const art = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n      s.send(\r\n        JSON.stringify({\r\n          type: \"CREATE_IMG\",\r\n          img: art,\r\n          ps: artsState.settings.pixelSize,\r\n          cs: artsState.settings.columnSize,\r\n          rs: artsState.settings.rowSize,\r\n          dc: artsState.settings.defColor,\r\n        })\r\n      );\r\n    };\r\n    s.onmessage = function (e) {\r\n      const id = JSON.parse(e.data).id;\r\n      fetch(\"/get-img/\" + id, {\r\n        method: \"GET\",\r\n      })\r\n        .then((res) => {\r\n          return res.blob();\r\n        })\r\n        .then((data) => {\r\n          setShowModal(true);\r\n          const blob = new Blob([data]);\r\n          const url = window.URL.createObjectURL(blob);\r\n          setImgUrl(url);\r\n          s.close();\r\n        })\r\n        .catch((err) => {\r\n          s.close();\r\n        });\r\n    };\r\n  };\r\n\r\n  const onCloseModal = () => {\r\n    setShowModal(false);\r\n  };\r\n\r\n  const onDownloadImg = () => {\r\n    const link = document.createElement(\"a\");\r\n    link.download = \"download.png\";\r\n    link.href = imgUrl;\r\n    link.click();\r\n  };\r\n\r\n  const chosenArt = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n\r\n  let modal;\r\n  if (showModal) {\r\n    modal = (\r\n      <Modal closed={onCloseModal}>\r\n        <h2 style={{ textAlign: \"center\" }}>PREVIEW</h2>\r\n        <div className={classes.ImgContainer}>\r\n          {chosenArt.rows.map((row, i) => (\r\n            <div className={classes.ArtRow} key={i}>\r\n              {row.map((pix) => (\r\n                <div\r\n                  key={pix.ypos.toString() + pix.xpos}\r\n                  style={{\r\n                    backgroundColor: pix.color,\r\n                    width: \"10px\",\r\n                    height: \"10px\",\r\n                  }}\r\n                ></div>\r\n              ))}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          className={classes.DownloadButton}\r\n          onClick={onDownloadImg}\r\n        >\r\n          DOWNLOAD\r\n        </button>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSaveImage}>\r\n      <Button type=\"submit\">DOWNLOAD</Button>\r\n      {showModal && modal}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SaveImage;\r\n"]},"metadata":{},"sourceType":"module"}