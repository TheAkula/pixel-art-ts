{"ast":null,"code":"import _objectSpread from\"C:/Users/Pechenka/pixel-app-ts/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Pechenka/pixel-app-ts/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import classes from\"./Board.module.css\";import createArt from\"../../hoc/createArt\";import{SettingsContext}from\"../../context/settings-context\";import{ArtsContext}from\"../../context/arts-context\";import{useContext,useEffect,useRef,useState}from\"react\";import Pixel from\"./Pixel/Pixel\";import{jsx as _jsx}from\"react/jsx-runtime\";var Board=function Board(){var _useContext=useContext(SettingsContext),settings=_useContext.settings,settingsDispatch=_useContext.settingsDispatch;var _ref=useContext(ArtsContext),arts=_ref.arts,artsDispatch=_ref.artsDispatch;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),draggedPixels=_useState2[0],setDraggedPixels=_useState2[1];var boardRef=useRef(null);useEffect(function(){if(arts.chosen===null){var rows=createArt(settings);artsDispatch({type:\"ADD_ART\",data:{rows:rows,id:arts.arts.length}});}},[artsDispatch,settings,arts]);var onDragEnd=function onDragEnd(e){e.preventDefault();setDraggedPixels(null);document.removeEventListener(\"dragend\",onDragEnd);};var onDragStart=function onDragStart(e){var clone=e.target.cloneNode(true);clone.style.display=\"none\";e.dataTransfer.setDragImage(clone,0,0);document.addEventListener(\"dragend\",onDragEnd);};var pixelClickedHandler=function pixelClickedHandler(xpos,ypos,color){return function(e){e.preventDefault();switch(settings.tool){case\"BRUSH\":e.target.style.backgroundColor=settings.color;artsDispatch({type:\"SET_PIX\",artId:arts.chosen,data:settings.color,x:xpos,y:ypos});break;case\"ERASER\":e.target.style.backgroundColor=settings.defColor;artsDispatch({type:\"SET_PIX\",artId:arts.chosen,data:settings.defColor,x:xpos,y:ypos});break;case\"FILL\":var _art=JSON.parse(JSON.stringify(arts.arts.find(function(art){return art.id===arts.chosen;})));var fillPix=function fillPix(x,y){var checkPix=function checkPix(xp,yp){if(yp>_art.rows.length-1||yp<0||xp>_art.rows[yp].length||xp<0)return false;var pix=_art.rows[yp][xp];if(!pix)return false;var colorP=pix.color;return colorP!==settings.color&&colorP===color;};_art.rows[y][x].color=settings.color;if(checkPix(x+1,y)){fillPix(x+1,y);}if(checkPix(x,y+1)){fillPix(x,y+1);}if(checkPix(x,y-1)){fillPix(x,y-1);}if(checkPix(x-1,y)){fillPix(x-1,y);}};fillPix(xpos,ypos);artsDispatch({type:\"UPD_ART\",artId:arts.chosen,data:_art});break;case\"PIPETTE\":settingsDispatch({type:\"SET_COLOR\",data:color});break;case\"MOVE\":var dragPix=draggedPixels;if(!dragPix){setDraggedPixels({x:xpos,y:ypos});dragPix={x:xpos,y:ypos};}var x=xpos-dragPix.x;var y=ypos-dragPix.y;if(x>0){x=Math.floor(x/2);}else{x=Math.ceil(x/2);}if(y>0){y=Math.floor(y/2);}else{y=Math.ceil(y/2);}if(Math.abs(x)===1){setDraggedPixels({x:xpos,y:draggedPixels.y});}if(Math.abs(y)===1){setDraggedPixels({x:draggedPixels.x,y:ypos});}var newArt=JSON.parse(JSON.stringify(arts.arts.find(function(art){return art.id===arts.chosen;})));newArt.rows.forEach(function(row,ind){row.forEach(function(pix){var newX=pix.xpos+x;var newY=pix.ypos+y;pix.xpos=newX>row.length-1?newX-row.length:newX<0?row.length+newX:newX;pix.ypos=newY>newArt.rows.length-1?newY-newArt.rows.length:newY<0?newArt.rows.length+newY:newY;});if(x>0){newArt.rows[ind]=row.slice(row.length-x).concat(row.slice(0,row.length-x));}else{newArt.rows[ind]=row.slice(Math.abs(x)).concat(row.slice(0,Math.abs(x)));}});if(y>0){newArt.rows=newArt.rows.slice(newArt.rows.length-y).concat(newArt.rows.slice(0,newArt.rows.length-y));}else{newArt.rows=newArt.rows.slice(Math.abs(y)).concat(newArt.rows.slice(0,Math.abs(y)));}artsDispatch({type:\"UPD_ART\",data:newArt,artId:arts.chosen});break;default:return;}};};var art=null;if(arts.arts.length){art=arts.arts.find(function(art){return art.id===arts.chosen;});}var ps=(600+settings.columnSize)/settings.columnSize;return/*#__PURE__*/_jsx(\"div\",{ref:boardRef,className:classes.Board,children:art&&art.rows.map(function(arr){return arr.map(function(pixel){return/*#__PURE__*/_jsx(Pixel,_objectSpread({size:ps,clicked:pixelClickedHandler,dragStarted:onDragStart},pixel),pixel.ypos.toString()+pixel.xpos);});})});};export default Board;","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/src/components/Board/Board.tsx"],"names":["classes","createArt","SettingsContext","ArtsContext","useContext","useEffect","useRef","useState","Pixel","Board","settings","settingsDispatch","arts","artsDispatch","draggedPixels","setDraggedPixels","boardRef","chosen","rows","type","data","id","length","onDragEnd","e","preventDefault","document","removeEventListener","onDragStart","clone","target","cloneNode","style","display","dataTransfer","setDragImage","addEventListener","pixelClickedHandler","xpos","ypos","color","tool","backgroundColor","artId","x","y","defColor","art","JSON","parse","stringify","find","fillPix","checkPix","xp","yp","pix","colorP","dragPix","Math","floor","ceil","abs","newArt","forEach","row","ind","newX","newY","slice","concat","ps","columnSize","map","arr","pixel","toString"],"mappings":"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","sourcesContent":["import classes from \"./Board.module.css\";\r\nimport createArt from \"../../hoc/createArt\";\r\n\r\nimport { SettingsContext } from \"../../context/settings-context\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport {\r\n  DragEventHandler,\r\n  MouseEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Art } from \"../../context/arts-context\";\r\n\r\nimport Pixel from \"./Pixel/Pixel\";\r\n\r\nconst Board = () => {\r\n  const { settings, settingsDispatch } = useContext(SettingsContext);\r\n  const { arts, artsDispatch } = useContext(ArtsContext)!;\r\n  const [draggedPixels, setDraggedPixels] = useState<null | {\r\n    x: number;\r\n    y: number;\r\n  }>(null);\r\n  const boardRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (arts.chosen === null) {\r\n      const rows = createArt(settings!);\r\n      artsDispatch({\r\n        type: \"ADD_ART\",\r\n        data: {\r\n          rows: rows,\r\n          id: arts.arts.length,\r\n        },\r\n      });\r\n    }\r\n  }, [artsDispatch, settings, arts]);\r\n\r\n  const onDragEnd: EventListener = (e) => {\r\n    e.preventDefault();\r\n    setDraggedPixels(null);\r\n    document.removeEventListener(\"dragend\", onDragEnd);\r\n  };\r\n\r\n  const onDragStart: DragEventHandler = (e) => {\r\n    const clone = (e.target as HTMLElement).cloneNode(true);\r\n    (clone as HTMLElement).style.display = \"none\";\r\n    e.dataTransfer.setDragImage(clone as Element, 0, 0);\r\n    document.addEventListener(\"dragend\", onDragEnd);\r\n  };\r\n\r\n  const pixelClickedHandler = (xpos: number, ypos: number, color: string) => {\r\n    return ((e) => {\r\n      e.preventDefault();\r\n\r\n      switch (settings!.tool) {\r\n        case \"BRUSH\":\r\n          (e.target as HTMLElement).style.backgroundColor = settings!.color;\r\n          artsDispatch({\r\n            type: \"SET_PIX\",\r\n            artId: arts.chosen!,\r\n            data: settings!.color,\r\n            x: xpos,\r\n            y: ypos,\r\n          });\r\n          break;\r\n        case \"ERASER\":\r\n          (e.target as HTMLElement).style.backgroundColor = settings!.defColor;\r\n          artsDispatch({\r\n            type: \"SET_PIX\",\r\n            artId: arts.chosen!,\r\n            data: settings!.defColor,\r\n            x: xpos,\r\n            y: ypos,\r\n          });\r\n          break;\r\n        case \"FILL\":\r\n          const art: Art = JSON.parse(\r\n            JSON.stringify(arts.arts.find((art) => art.id === arts.chosen))\r\n          );\r\n          const fillPix = (x: number, y: number) => {\r\n            const checkPix = (xp: number, yp: number): boolean => {\r\n              if (\r\n                yp > art.rows.length - 1 ||\r\n                yp < 0 ||\r\n                xp > art.rows[yp].length ||\r\n                xp < 0\r\n              )\r\n                return false;\r\n              const pix = art.rows[yp][xp];\r\n              if (!pix) return false;\r\n              const colorP = pix.color;\r\n              return colorP !== settings!.color && colorP === color;\r\n            };\r\n            art.rows[y][x].color = settings!.color;\r\n\r\n            if (checkPix(x + 1, y)) {\r\n              fillPix(x + 1, y);\r\n            }\r\n            if (checkPix(x, y + 1)) {\r\n              fillPix(x, y + 1);\r\n            }\r\n            if (checkPix(x, y - 1)) {\r\n              fillPix(x, y - 1);\r\n            }\r\n            if (checkPix(x - 1, y)) {\r\n              fillPix(x - 1, y);\r\n            }\r\n          };\r\n          fillPix(xpos, ypos);\r\n          artsDispatch({ type: \"UPD_ART\", artId: arts.chosen!, data: art });\r\n          break;\r\n        case \"PIPETTE\":\r\n          settingsDispatch!({ type: \"SET_COLOR\", data: color });\r\n          break;\r\n        case \"MOVE\":\r\n          let dragPix = draggedPixels;\r\n          if (!dragPix) {\r\n            setDraggedPixels({ x: xpos, y: ypos });\r\n            dragPix = { x: xpos, y: ypos };\r\n          }\r\n          let x = xpos - dragPix!.x;\r\n          let y = ypos - dragPix!.y;\r\n          if (x > 0) {\r\n            x = Math.floor(x / 2);\r\n          } else {\r\n            x = Math.ceil(x / 2);\r\n          }\r\n          if (y > 0) {\r\n            y = Math.floor(y / 2);\r\n          } else {\r\n            y = Math.ceil(y / 2);\r\n          }\r\n\r\n          if (Math.abs(x) === 1) {\r\n            setDraggedPixels({ x: xpos, y: draggedPixels!.y });\r\n          }\r\n          if (Math.abs(y) === 1) {\r\n            setDraggedPixels({ x: draggedPixels!.x, y: ypos });\r\n          }\r\n          const newArt = JSON.parse(\r\n            JSON.stringify(arts.arts.find((art) => art.id === arts.chosen))\r\n          ) as Art;\r\n          newArt.rows.forEach((row, ind) => {\r\n            row.forEach((pix) => {\r\n              const newX = pix.xpos + x;\r\n              const newY = pix.ypos + y;\r\n              pix.xpos =\r\n                newX > row.length - 1\r\n                  ? newX - row.length\r\n                  : newX < 0\r\n                  ? row.length + newX\r\n                  : newX;\r\n              pix.ypos =\r\n                newY > newArt.rows.length - 1\r\n                  ? newY - newArt.rows.length\r\n                  : newY < 0\r\n                  ? newArt.rows.length + newY\r\n                  : newY;\r\n            });\r\n            if (x > 0) {\r\n              newArt.rows[ind] = row\r\n                .slice(row.length - x)\r\n                .concat(row.slice(0, row.length - x));\r\n            } else {\r\n              newArt.rows[ind] = row\r\n                .slice(Math.abs(x))\r\n                .concat(row.slice(0, Math.abs(x)));\r\n            }\r\n          });\r\n          if (y > 0) {\r\n            newArt.rows = newArt.rows\r\n              .slice(newArt.rows.length - y)\r\n              .concat(newArt.rows.slice(0, newArt.rows.length - y));\r\n          } else {\r\n            newArt.rows = newArt.rows\r\n              .slice(Math.abs(y))\r\n              .concat(newArt.rows.slice(0, Math.abs(y)));\r\n          }\r\n          artsDispatch({\r\n            type: \"UPD_ART\",\r\n            data: newArt,\r\n            artId: arts.chosen!,\r\n          });\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n    }) as MouseEventHandler<HTMLDivElement>;\r\n  };\r\n\r\n  let art: null | Art = null;\r\n\r\n  if (arts.arts.length) {\r\n    art = arts.arts!.find((art) => art.id === arts.chosen)!;\r\n  }\r\n\r\n  const ps = (600 + settings!.columnSize) / settings!.columnSize;\r\n  return (\r\n    <div ref={boardRef} className={classes.Board}>\r\n      {art &&\r\n        art.rows.map((arr) => {\r\n          return arr.map((pixel) => (\r\n            <Pixel\r\n              size={ps}\r\n              clicked={pixelClickedHandler}\r\n              dragStarted={onDragStart}\r\n              key={pixel.ypos.toString() + pixel.xpos}\r\n              {...pixel}\r\n            />\r\n          ));\r\n        })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Board;\r\n"]},"metadata":{},"sourceType":"module"}