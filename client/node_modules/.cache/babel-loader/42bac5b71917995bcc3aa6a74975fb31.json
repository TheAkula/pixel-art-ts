{"ast":null,"code":"import _objectSpread from\"C:/Users/Pechenka/pixel-app-ts/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Pechenka/pixel-app-ts/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import classes from\"./Board.module.css\";import{SettingsContext}from\"../../context/settings-context\";import{ArtsContext}from\"../../context/arts-context\";import{useContext,useEffect,useRef,useState}from\"react\";import Pixel from\"./Pixel/Pixel\";import{jsx as _jsx}from\"react/jsx-runtime\";var Board=function Board(){var _useContext=useContext(SettingsContext),settings=_useContext.settings,settingsDispatch=_useContext.settingsDispatch;var _ref=useContext(ArtsContext),arts=_ref.arts,artsDispatch=_ref.artsDispatch;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),draggedPixels=_useState2[0],setDraggedPixels=_useState2[1];var boardRef=useRef(null);useEffect(function(){if(!arts.chosen){var board=[];for(var i=0;i<settings.rowSize;i++){var arr=[];for(var j=0;j<settings.columnSize;j++){arr.push({xpos:j,ypos:i,color:settings.defColor});}board.push(arr);}var id=Math.random().toString();artsDispatch({type:\"ADD_ART\",data:{rows:board,id:id}});artsDispatch({type:\"SET_CHOSEN\",data:id});}},[artsDispatch,settings,arts]);var onDragEnd=function onDragEnd(e){e.preventDefault();setDraggedPixels(null);document.removeEventListener(\"dragend\",onDragEnd);};var onDragStart=function onDragStart(e){var clone=e.target.cloneNode(true);clone.style.display=\"none\";e.dataTransfer.setDragImage(clone,0,0);document.addEventListener(\"dragend\",onDragEnd);};var pixelClickedHandler=function pixelClickedHandler(xpos,ypos,color){return function(e){e.preventDefault();switch(settings.tool){case\"BRUSH\":e.target.style.backgroundColor=settings.color;artsDispatch({type:\"SET_PIX\",artId:arts.chosen,data:settings.color,x:xpos,y:ypos});break;case\"ERASER\":e.target.style.backgroundColor=settings.defColor;artsDispatch({type:\"SET_PIX\",artId:arts.chosen,data:settings.defColor,x:xpos,y:ypos});break;case\"FILL\":var _art=JSON.parse(JSON.stringify(arts.arts.find(function(art){return art.id===arts.chosen;})));var fillPix=function fillPix(x,y){var checkPix=function checkPix(xp,yp){if(yp>_art.rows.length-1||yp<0||xp>_art.rows[yp].length||xp<0)return false;var pix=_art.rows[yp][xp];if(!pix)return false;var colorP=pix.color;return colorP!==settings.color&&colorP===color;};_art.rows[y][x].color=settings.color;if(checkPix(x+1,y)){fillPix(x+1,y);}if(checkPix(x,y+1)){fillPix(x,y+1);}if(checkPix(x,y-1)){fillPix(x,y-1);}if(checkPix(x-1,y)){fillPix(x-1,y);}};fillPix(xpos,ypos);artsDispatch({type:\"UPD_ART\",artId:arts.chosen,data:_art});break;case\"PIPETTE\":settingsDispatch({type:\"SET_COLOR\",data:color});break;case\"MOVE\":var dragPix=draggedPixels;if(!dragPix){setDraggedPixels({x:xpos,y:ypos});dragPix={x:xpos,y:ypos};}var x=xpos-dragPix.x;var y=ypos-dragPix.y;if(x>0){x=Math.floor(x/2);}else{x=Math.ceil(x/2);}if(y>0){y=Math.floor(y/2);}else{y=Math.ceil(y/2);}if(Math.abs(x)===1){setDraggedPixels({x:xpos,y:draggedPixels.y});}if(Math.abs(y)===1){setDraggedPixels({x:draggedPixels.x,y:ypos});}var newArt=JSON.parse(JSON.stringify(arts.arts.find(function(art){return art.id===arts.chosen;})));newArt.rows.forEach(function(row,ind){row.forEach(function(pix){var newX=pix.xpos+x;var newY=pix.ypos+y;pix.xpos=newX>row.length-1?newX-row.length:newX<0?row.length+newX:newX;pix.ypos=newY>newArt.rows.length-1?newY-newArt.rows.length:newY<0?newArt.rows.length+newY:newY;});if(x>0){newArt.rows[ind]=row.slice(row.length-x).concat(row.slice(0,row.length-x));}else{newArt.rows[ind]=row.slice(Math.abs(x)).concat(row.slice(0,Math.abs(x)));}});if(y>0){newArt.rows=newArt.rows.slice(newArt.rows.length-y).concat(newArt.rows.slice(0,newArt.rows.length-y));}else{newArt.rows=newArt.rows.slice(Math.abs(y)).concat(newArt.rows.slice(0,Math.abs(y)));}artsDispatch({type:\"UPD_ART\",data:newArt,artId:arts.chosen});break;default:return;}};};var art=null;if(arts.arts.length){art=arts.arts.find(function(art){return art.id===arts.chosen;});}var ps=(600+settings.columnSize)/settings.columnSize;return/*#__PURE__*/_jsx(\"div\",{ref:boardRef,className:classes.Board,children:art&&art.rows.map(function(arr){return arr.map(function(pixel){return/*#__PURE__*/_jsx(Pixel,_objectSpread({size:ps,clicked:pixelClickedHandler,dragStarted:onDragStart},pixel),pixel.ypos.toString()+pixel.xpos);});})});};export default Board;","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/src/components/Board/Board.tsx"],"names":["classes","SettingsContext","ArtsContext","useContext","useEffect","useRef","useState","Pixel","Board","settings","settingsDispatch","arts","artsDispatch","draggedPixels","setDraggedPixels","boardRef","chosen","board","i","rowSize","arr","j","columnSize","push","xpos","ypos","color","defColor","id","Math","random","toString","type","data","rows","onDragEnd","e","preventDefault","document","removeEventListener","onDragStart","clone","target","cloneNode","style","display","dataTransfer","setDragImage","addEventListener","pixelClickedHandler","tool","backgroundColor","artId","x","y","art","JSON","parse","stringify","find","fillPix","checkPix","xp","yp","length","pix","colorP","dragPix","floor","ceil","abs","newArt","forEach","row","ind","newX","newY","slice","concat","ps","map","pixel"],"mappings":"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","sourcesContent":["import classes from \"./Board.module.css\";\r\n\r\nimport { SettingsContext } from \"../../context/settings-context\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport {\r\n  DragEventHandler,\r\n  MouseEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Art } from \"../../context/arts-context\";\r\n\r\nimport Pixel from \"./Pixel/Pixel\";\r\n\r\nconst Board = () => {\r\n  const { settings, settingsDispatch } = useContext(SettingsContext);\r\n  const { arts, artsDispatch } = useContext(ArtsContext)!;\r\n  const [draggedPixels, setDraggedPixels] = useState<null | {\r\n    x: number;\r\n    y: number;\r\n  }>(null);\r\n  const boardRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!arts.chosen) {\r\n      const board: { xpos: number; ypos: number; color: string }[][] = [];\r\n      for (let i = 0; i < settings!.rowSize; i++) {\r\n        let arr = [];\r\n        for (let j = 0; j < settings!.columnSize; j++) {\r\n          arr.push({ xpos: j, ypos: i, color: settings!.defColor });\r\n        }\r\n        board.push(arr);\r\n      }\r\n      const id = Math.random().toString();\r\n      artsDispatch({\r\n        type: \"ADD_ART\",\r\n        data: {\r\n          rows: board,\r\n          id: id,\r\n        },\r\n      });\r\n      artsDispatch({ type: \"SET_CHOSEN\", data: id });\r\n    }\r\n  }, [artsDispatch, settings, arts]);\r\n\r\n  const onDragEnd: EventListener = (e) => {\r\n    e.preventDefault();\r\n    setDraggedPixels(null);\r\n    document.removeEventListener(\"dragend\", onDragEnd);\r\n  };\r\n\r\n  const onDragStart: DragEventHandler = (e) => {\r\n    const clone = (e.target as HTMLElement).cloneNode(true);\r\n    (clone as HTMLElement).style.display = \"none\";\r\n    e.dataTransfer.setDragImage(clone as Element, 0, 0);\r\n    document.addEventListener(\"dragend\", onDragEnd);\r\n  };\r\n\r\n  const pixelClickedHandler = (xpos: number, ypos: number, color: string) => {\r\n    return ((e) => {\r\n      e.preventDefault();\r\n\r\n      switch (settings!.tool) {\r\n        case \"BRUSH\":\r\n          (e.target as HTMLElement).style.backgroundColor = settings!.color;\r\n          artsDispatch({\r\n            type: \"SET_PIX\",\r\n            artId: arts.chosen!,\r\n            data: settings!.color,\r\n            x: xpos,\r\n            y: ypos,\r\n          });\r\n          break;\r\n        case \"ERASER\":\r\n          (e.target as HTMLElement).style.backgroundColor = settings!.defColor;\r\n          artsDispatch({\r\n            type: \"SET_PIX\",\r\n            artId: arts.chosen!,\r\n            data: settings!.defColor,\r\n            x: xpos,\r\n            y: ypos,\r\n          });\r\n          break;\r\n        case \"FILL\":\r\n          const art: Art = JSON.parse(\r\n            JSON.stringify(arts.arts.find((art) => art.id === arts.chosen))\r\n          );\r\n          const fillPix = (x: number, y: number) => {\r\n            const checkPix = (xp: number, yp: number): boolean => {\r\n              if (\r\n                yp > art.rows.length - 1 ||\r\n                yp < 0 ||\r\n                xp > art.rows[yp].length ||\r\n                xp < 0\r\n              )\r\n                return false;\r\n              const pix = art.rows[yp][xp];\r\n              if (!pix) return false;\r\n              const colorP = pix.color;\r\n              return colorP !== settings!.color && colorP === color;\r\n            };\r\n            art.rows[y][x].color = settings!.color;\r\n\r\n            if (checkPix(x + 1, y)) {\r\n              fillPix(x + 1, y);\r\n            }\r\n            if (checkPix(x, y + 1)) {\r\n              fillPix(x, y + 1);\r\n            }\r\n            if (checkPix(x, y - 1)) {\r\n              fillPix(x, y - 1);\r\n            }\r\n            if (checkPix(x - 1, y)) {\r\n              fillPix(x - 1, y);\r\n            }\r\n          };\r\n          fillPix(xpos, ypos);\r\n          artsDispatch({ type: \"UPD_ART\", artId: arts.chosen!, data: art });\r\n          break;\r\n        case \"PIPETTE\":\r\n          settingsDispatch!({ type: \"SET_COLOR\", data: color });\r\n          break;\r\n        case \"MOVE\":\r\n          let dragPix = draggedPixels;\r\n          if (!dragPix) {\r\n            setDraggedPixels({ x: xpos, y: ypos });\r\n            dragPix = { x: xpos, y: ypos };\r\n          }\r\n          let x = xpos - dragPix!.x;\r\n          let y = ypos - dragPix!.y;\r\n          if (x > 0) {\r\n            x = Math.floor(x / 2);\r\n          } else {\r\n            x = Math.ceil(x / 2);\r\n          }\r\n          if (y > 0) {\r\n            y = Math.floor(y / 2);\r\n          } else {\r\n            y = Math.ceil(y / 2);\r\n          }\r\n\r\n          if (Math.abs(x) === 1) {\r\n            setDraggedPixels({ x: xpos, y: draggedPixels!.y });\r\n          }\r\n          if (Math.abs(y) === 1) {\r\n            setDraggedPixels({ x: draggedPixels!.x, y: ypos });\r\n          }\r\n          const newArt = JSON.parse(\r\n            JSON.stringify(arts.arts.find((art) => art.id === arts.chosen))\r\n          ) as Art;\r\n          newArt.rows.forEach((row, ind) => {\r\n            row.forEach((pix) => {\r\n              const newX = pix.xpos + x;\r\n              const newY = pix.ypos + y;\r\n              pix.xpos =\r\n                newX > row.length - 1\r\n                  ? newX - row.length\r\n                  : newX < 0\r\n                  ? row.length + newX\r\n                  : newX;\r\n              pix.ypos =\r\n                newY > newArt.rows.length - 1\r\n                  ? newY - newArt.rows.length\r\n                  : newY < 0\r\n                  ? newArt.rows.length + newY\r\n                  : newY;\r\n            });\r\n            if (x > 0) {\r\n              newArt.rows[ind] = row\r\n                .slice(row.length - x)\r\n                .concat(row.slice(0, row.length - x));\r\n            } else {\r\n              newArt.rows[ind] = row\r\n                .slice(Math.abs(x))\r\n                .concat(row.slice(0, Math.abs(x)));\r\n            }\r\n          });\r\n          if (y > 0) {\r\n            newArt.rows = newArt.rows\r\n              .slice(newArt.rows.length - y)\r\n              .concat(newArt.rows.slice(0, newArt.rows.length - y));\r\n          } else {\r\n            newArt.rows = newArt.rows\r\n              .slice(Math.abs(y))\r\n              .concat(newArt.rows.slice(0, Math.abs(y)));\r\n          }\r\n          artsDispatch({\r\n            type: \"UPD_ART\",\r\n            data: newArt,\r\n            artId: arts.chosen!,\r\n          });\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n    }) as MouseEventHandler<HTMLDivElement>;\r\n  };\r\n\r\n  let art: null | Art = null;\r\n\r\n  if (arts.arts.length) {\r\n    art = arts.arts!.find((art) => art.id === arts.chosen)!;\r\n  }\r\n\r\n  const ps = (600 + settings!.columnSize) / settings!.columnSize;\r\n  return (\r\n    <div ref={boardRef} className={classes.Board}>\r\n      {art &&\r\n        art.rows.map((arr) => {\r\n          return arr.map((pixel) => (\r\n            <Pixel\r\n              size={ps}\r\n              clicked={pixelClickedHandler}\r\n              dragStarted={onDragStart}\r\n              key={pixel.ypos.toString() + pixel.xpos}\r\n              {...pixel}\r\n            />\r\n          ));\r\n        })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Board;\r\n"]},"metadata":{},"sourceType":"module"}