{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Pechenka\\\\pixel-app-ts\\\\client\\\\src\\\\components\\\\SaveImage\\\\SaveImage.tsx\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from \"react\";\nimport classes from \"./SaveImage.module.css\";\nimport { ArtsContext } from \"../../context/arts-context\";\nimport Modal from \"../UI/Modal/Modal\";\nimport Button from \"../UI/Button/Button\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SaveImage = () => {\n  _s();\n\n  const {\n    artsState\n  } = useContext(ArtsContext);\n  const [showModal, setShowModal] = useState(false);\n  const [imgUrl, setImgUrl] = useState(\"\");\n  useEffect(() => {\n    if (showModal) document.body.style.overflow = \"hidden\";else document.body.style.overflow = \"auto\";\n  }, [showModal]);\n\n  const onSaveImage = e => {\n    e.preventDefault();\n    const s = new WebSocket(\"wss://pixel-art-ts.herokuapp.com\");\n\n    s.onopen = e => {\n      const art = artsState.arts.find(art => art.id === artsState.chosen);\n      s.send(JSON.stringify({\n        type: \"CREATE_IMG\",\n        img: art,\n        ps: artsState.settings.pixelSize,\n        cs: artsState.settings.columnSize,\n        rs: artsState.settings.rowSize,\n        dc: artsState.settings.defColor\n      }));\n    };\n\n    s.onmessage = function (e) {\n      const id = JSON.parse(e.data).id;\n      fetch(\"/get-img/\" + id, {\n        method: \"GET\"\n      }).then(res => {\n        return res.blob();\n      }).then(data => {\n        setShowModal(true);\n        const blob = new Blob([data]);\n        const url = window.URL.createObjectURL(blob);\n        setImgUrl(url);\n        s.close();\n      }).catch(err => {\n        s.close();\n      });\n    };\n  };\n\n  const onCloseModal = () => {\n    setShowModal(false);\n  };\n\n  const onDownloadImg = () => {\n    const link = document.createElement(\"a\");\n    link.download = \"download.png\";\n    link.href = imgUrl;\n    link.click();\n  };\n\n  const chosenArt = artsState.arts.find(art => art.id === artsState.chosen);\n  let modal;\n\n  if (showModal) {\n    modal = /*#__PURE__*/_jsxDEV(Modal, {\n      closed: onCloseModal,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          textAlign: \"center\"\n        },\n        children: \"PREVIEW\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.ImgContainer,\n        children: chosenArt.rows.map((row, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.ArtRow,\n          children: row.map(pix => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              backgroundColor: pix.color,\n              width: \"10px\",\n              height: \"10px\"\n            }\n          }, pix.ypos.toString() + pix.xpos, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 17\n          }, this))\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: classes.DownloadButton,\n        onClick: onDownloadImg,\n        children: \"DOWNLOAD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: onSaveImage,\n    children: [/*#__PURE__*/_jsxDEV(Button, {\n      type: \"submit\",\n      children: \"DOWNLOAD\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this), showModal && modal]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SaveImage, \"gYE9k1wfbA+W8WrDLDr0N3XuW8M=\");\n\n_c = SaveImage;\nexport default SaveImage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SaveImage\");","map":{"version":3,"sources":["C:/Users/Pechenka/pixel-app-ts/client/src/components/SaveImage/SaveImage.tsx"],"names":["useContext","useEffect","useState","classes","ArtsContext","Modal","Button","SaveImage","artsState","showModal","setShowModal","imgUrl","setImgUrl","document","body","style","overflow","onSaveImage","e","preventDefault","s","WebSocket","onopen","art","arts","find","id","chosen","send","JSON","stringify","type","img","ps","settings","pixelSize","cs","columnSize","rs","rowSize","dc","defColor","onmessage","parse","data","fetch","method","then","res","blob","Blob","url","window","URL","createObjectURL","close","catch","err","onCloseModal","onDownloadImg","link","createElement","download","href","click","chosenArt","modal","textAlign","ImgContainer","rows","map","row","i","ArtRow","pix","backgroundColor","color","width","height","ypos","toString","xpos","DownloadButton"],"mappings":"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","sourcesContent":["import {\r\n  FormEventHandler,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport classes from \"./SaveImage.module.css\";\r\nimport { ArtsContext } from \"../../context/arts-context\";\r\nimport Modal from \"../UI/Modal/Modal\";\r\nimport Button from \"../UI/Button/Button\";\r\n\r\nconst SaveImage = () => {\r\n  const { artsState } = useContext(ArtsContext)!;\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [imgUrl, setImgUrl] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (showModal) document.body.style.overflow = \"hidden\";\r\n    else document.body.style.overflow = \"auto\";\r\n  }, [showModal]);\r\n\r\n  const onSaveImage: FormEventHandler = (e) => {\r\n    e.preventDefault();\r\n    const s = new WebSocket(\"wss://pixel-art-ts.herokuapp.com\");\r\n    s.onopen = (e) => {\r\n      const art = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n      s.send(\r\n        JSON.stringify({\r\n          type: \"CREATE_IMG\",\r\n          img: art,\r\n          ps: artsState.settings.pixelSize,\r\n          cs: artsState.settings.columnSize,\r\n          rs: artsState.settings.rowSize,\r\n          dc: artsState.settings.defColor,\r\n        })\r\n      );\r\n    };\r\n    s.onmessage = function (e) {\r\n      const id = JSON.parse(e.data).id;\r\n      fetch(\"/get-img/\" + id, {\r\n        method: \"GET\",\r\n      })\r\n        .then((res) => {\r\n          return res.blob();\r\n        })\r\n        .then((data) => {\r\n          setShowModal(true);\r\n          const blob = new Blob([data]);\r\n          const url = window.URL.createObjectURL(blob);\r\n          setImgUrl(url);\r\n          s.close();\r\n        })\r\n        .catch((err) => {\r\n          s.close();\r\n        });\r\n    };\r\n  };\r\n\r\n  const onCloseModal = () => {\r\n    setShowModal(false);\r\n  };\r\n\r\n  const onDownloadImg = () => {\r\n    const link = document.createElement(\"a\");\r\n    link.download = \"download.png\";\r\n    link.href = imgUrl;\r\n    link.click();\r\n  };\r\n\r\n  const chosenArt = artsState.arts.find((art) => art.id === artsState.chosen)!;\r\n\r\n  let modal;\r\n  if (showModal) {\r\n    modal = (\r\n      <Modal closed={onCloseModal}>\r\n        <h2 style={{ textAlign: \"center\" }}>PREVIEW</h2>\r\n        <div className={classes.ImgContainer}>\r\n          {chosenArt.rows.map((row, i) => (\r\n            <div className={classes.ArtRow} key={i}>\r\n              {row.map((pix) => (\r\n                <div\r\n                  key={pix.ypos.toString() + pix.xpos}\r\n                  style={{\r\n                    backgroundColor: pix.color,\r\n                    width: \"10px\",\r\n                    height: \"10px\",\r\n                  }}\r\n                ></div>\r\n              ))}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          className={classes.DownloadButton}\r\n          onClick={onDownloadImg}\r\n        >\r\n          DOWNLOAD\r\n        </button>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSaveImage}>\r\n      <Button type=\"submit\">DOWNLOAD</Button>\r\n      {showModal && modal}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SaveImage;\r\n"]},"metadata":{},"sourceType":"module"}